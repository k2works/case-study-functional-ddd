---
title: 要件定義 - 注文受付システム (OrderTaking)
description: 
published: true
date: 2025-09-16
tags: 
editor: markdown
dateCreated: 2025-09-16
---

# 要件定義 - 注文受付システム (OrderTaking)

## システム価値

### システムコンテキスト

```plantuml
@startuml

title システムコンテキスト図 - 注文受付システム

left to right direction

actor 顧客
actor 営業担当者
actor 倉庫担当者
actor 経理担当者

agent 在庫管理システム
agent 配送システム
agent 請求管理システム

usecase 注文受付システム
note top of 注文受付システム
  顧客からの注文を受け付け、検証し、
  価格計算を行い、関連部門へ
  適切な情報を配信するシステム
  
  主な価値提供：
  - 注文プロセスの自動化
  - エラーの早期検出
  - 部門間の情報連携
end note

顧客 -- (注文受付システム)
営業担当者 -- (注文受付システム)
(注文受付システム) -- 在庫管理システム
(注文受付システム) -- 配送システム
(注文受付システム) -- 請求管理システム
倉庫担当者 -- 配送システム
経理担当者 -- 請求管理システム

@enduml
```

### 要求モデル

```plantuml
@startuml

title 要求モデル図 - 注文受付システム

left to right direction

actor 顧客
note "商品を簡単に注文したい" as c_r1
note "注文内容を確認したい" as c_r2
note "注文状況を把握したい" as c_r3
note as c_dr1 #Turquoise
  注文プロセスが
  シンプルで分かりやすく、
  入力ミスを防げること
end note
顧客 -- c_r1
顧客 -- c_r2
顧客 -- c_r3
c_r1 -- c_dr1
c_r2 -- c_dr1
c_r3 -- c_dr1

actor 営業担当者
note "注文を迅速に処理したい" as s_r1
note "価格計算を自動化したい" as s_r2
note "エラーを早期発見したい" as s_r3
note as s_dr1 #Turquoise
  注文検証と価格計算が
  自動化され、
  ミスが減少すること
end note
営業担当者 -- s_r1
営業担当者 -- s_r2
営業担当者 -- s_r3
s_r1 -- s_dr1
s_r2 -- s_dr1
s_r3 -- s_dr1

@enduml
```

## システム外部環境

### ビジネスコンテキスト

```plantuml
@startuml

title ビジネスコンテキスト図 - 注文受付システム

left to right direction

actor 顧客
actor 配送業者

node "販売組織" {
  rectangle "営業部門" {
    actor 営業担当者
    actor 営業マネージャー
  }
  
  rectangle "物流部門" {
    actor 倉庫担当者
    actor 配送担当者
  }
  
  rectangle "経理部門" {
    actor 経理担当者
  }
  
  usecase 注文受付業務
  usecase 在庫管理業務
  usecase 配送管理業務
  usecase 請求管理業務
  
  artifact 注文データ
  artifact 在庫データ
  artifact 請求データ
}

node "外部システム" {
  agent 銀行システム
  agent 配送業者システム
}

顧客 -- (注文受付業務)
(注文受付業務) -- 営業担当者
(在庫管理業務) -- 倉庫担当者
(配送管理業務) -- 配送担当者
(請求管理業務) -- 経理担当者

(注文受付業務) -- 注文データ
(在庫管理業務) -- 在庫データ
(請求管理業務) -- 請求データ

(請求管理業務) -- 銀行システム
(配送管理業務) -- 配送業者システム

@enduml
```

### ビジネスユースケース

#### 注文受付業務

```plantuml
@startuml

title ビジネスユースケース図 - 注文受付業務

left to right direction

actor 顧客
actor 営業担当者
actor 倉庫担当者

agent 営業オフィス

usecase "注文を作成する" as uc_01
usecase "注文を検証する" as uc_02
usecase "価格を計算する" as uc_03
usecase "注文を確定する" as uc_04

artifact 注文書 as af_01
artifact 価格表 as af_02
artifact 在庫リスト as af_03

顧客 -- (uc_01)
営業担当者 -- (uc_02)
営業担当者 -- (uc_03)
営業担当者 -- (uc_04)
倉庫担当者 -- (uc_04)

(uc_01) -- 営業オフィス
(uc_02) -- 営業オフィス
(uc_03) -- 営業オフィス
(uc_04) -- 営業オフィス

(uc_01) -- af_01
(uc_03) -- af_02
(uc_02) -- af_03

@enduml
```

### 業務フロー

#### 注文受付の業務フロー

```plantuml
@startuml

title 業務フロー図 - 注文受付

|顧客|
partition 注文作成 {
  :商品を選択;
  :数量を入力;
  :配送先を入力;
  :請求先を入力;
  :注文を送信;
}

|営業担当者|
partition 注文検証 {
  :注文内容を確認;
  :商品コードを検証;
  :在庫を確認;
  split
    :住所を検証;
  split again
    -> 住所が無効な場合;
    :エラーを返す;
    stop
  end split
  :価格を計算;
}

|システム|
partition 注文処理 {
  :注文を確定;
  :配送指示を作成;
  :請求データを作成;
  :確認メールを送信;
}

|顧客|
partition 注文確認 {
  :確認メールを受信;
  :注文内容を確認;
}
stop

@enduml
```

### 利用シーン

#### 注文受付の利用シーン

```plantuml
@startuml

title 利用シーン図 - 注文受付

left to right direction

actor 顧客
actor 営業担当者

frame 新規注文作成シーン
note right of 新規注文作成シーン
  背景：顧客が新規に商品を注文する
  目的：必要な商品を適切な数量で発注
  期待効果：正確で迅速な注文処理
  前提条件：顧客情報が登録済み
end note

frame 注文変更シーン
note right of 注文変更シーン
  背景：既存注文の内容を変更する必要がある
  目的：数量や配送先の変更
  期待効果：柔軟な注文対応
  制約条件：出荷前まで変更可能
end note

usecase 注文を作成
usecase 注文を検証
usecase 価格を計算

顧客 -- 新規注文作成シーン
営業担当者 -- 新規注文作成シーン
新規注文作成シーン -- (注文を作成)
新規注文作成シーン -- (注文を検証)

営業担当者 -- 注文変更シーン
注文変更シーン -- (価格を計算)

@enduml
```

### バリエーション・条件

#### 商品タイプ

| 分類名 | 説明 |
|--------|------|
| Widget | 単位数量で注文する商品（1〜1000個） |
| Gizmo | 重量（キログラム）で注文する商品（0.05〜100.00kg） |

#### 注文ステータス

| 分類名 | 説明 |
|--------|------|
| 未検証 | 顧客から受信したが未検証の注文 |
| 検証済み | 内容が検証され、エラーがない注文 |
| 価格計算済み | 価格計算が完了した注文 |
| 確定済み | 処理が完了し、関連部門に通知済みの注文 |

#### エラータイプ

| 分類名 | 説明 |
|--------|------|
| 検証エラー | 入力データの形式や値が不正 |
| 価格計算エラー | 価格計算中に発生したエラー |
| リモートサービスエラー | 外部システムとの通信エラー |

## システム境界

### ユースケース複合図

#### 注文受付処理

```plantuml
@startuml

title ユースケース複合図 - 注文受付処理

left to right direction

actor 顧客 as customer
actor 営業担当者 as sales

frame "新規注文作成" as f01
usecase "注文を送信" as UC1
usecase "注文を検証" as UC2
usecase "価格を計算" as UC3
boundary "注文入力画面" as b01
boundary "注文確認画面" as b02
entity "注文情報" as e01
entity "商品情報" as e02
entity "顧客情報" as e03
control "検証ルール" as c01
control "価格計算ルール" as c02
interface "注文確定イベント" as i01

customer -- f01
sales -- f01
f01 -- UC1
f01 -- UC2
f01 -- UC3

b01 -- UC1
UC1 -- e01
UC1 -- c01

b02 -- UC2
UC2 -- e01
UC2 -- e02
UC2 -- e03
UC2 -- c01

UC3 -- e02
UC3 -- c02
UC3 -- i01

@enduml
```

## システム

### 情報モデル

```plantuml
@startuml

title 情報モデル図 - 注文受付システム

left to right direction

' 注文関連
entity 注文
entity 注文明細
entity 価格付き注文

' 顧客関連
entity 顧客情報
entity 個人名
entity メールアドレス

' 商品関連
entity 商品コード
entity Widget商品
entity Gizmo商品

' 住所関連
entity 住所
entity 郵便番号

' 価格関連
entity 価格
entity 請求金額

' イベント関連
entity 注文確定イベント
entity 請求可能注文イベント
entity 確認送信済みイベント

' 関連付け
注文 -- 注文明細
注文明細 -- 商品コード

注文 -- 顧客情報
顧客情報 -- 個人名
顧客情報 -- メールアドレス

商品コード -- Widget商品
商品コード -- Gizmo商品

注文 -- 住所
住所 -- 郵便番号

価格付き注文 -- 注文
価格付き注文 -- 価格
価格付き注文 -- 請求金額

価格付き注文 -- 注文確定イベント
価格付き注文 -- 請求可能注文イベント
価格付き注文 -- 確認送信済みイベント

@enduml
```

### 状態モデル

#### 注文の状態遷移

```plantuml
@startuml
[*] --> 未検証

未検証 --> 検証中 : 検証開始
検証中 --> 検証済み : 検証成功
検証中 --> エラー : 検証失敗

state 検証済み {
  [*] --> 価格計算待ち
  価格計算待ち --> 価格計算中 : 価格計算開始
  価格計算中 --> 価格計算完了 : 計算成功
  価格計算中 --> 価格計算エラー : 計算失敗
}

価格計算完了 --> 確定処理中 : 確定処理開始
確定処理中 --> 確定済み : 処理成功

確定済み --> 配送準備 : 配送指示作成
確定済み --> 請求処理 : 請求データ作成
確定済み --> 確認送信 : 確認メール送信

配送準備 --> [*]
請求処理 --> [*]
確認送信 --> [*]
エラー --> [*]
価格計算エラー --> [*]
@enduml
```

#### 注文明細の状態遷移

```plantuml
@startuml
title 注文明細の状態遷移図

[*] --> 未検証 : 作成

未検証 --> 商品コード検証中 : 検証開始
商品コード検証中 --> 数量検証中 : コード有効
商品コード検証中 --> 無効 : コード無効

数量検証中 --> 検証済み : 数量有効
数量検証中 --> 無効 : 数量無効

検証済み --> 価格計算中 : 価格計算開始
価格計算中 --> 価格設定済み : 計算完了

価格設定済み --> 確定 : 注文確定
確定 --> [*]
無効 --> [*]
@enduml
```

---

## 記入ガイド

このドキュメントは、RDRA（Relationship Driven Requirement Analysis）の手法に基づいて、注文受付システムの要件を体系的に整理したものです。

### 主要な要件

1. **注文検証機能**
   - 商品コードの妥当性確認
   - 数量の範囲チェック（Widget: 1-1000個、Gizmo: 0.05-100kg）
   - 住所の妥当性確認

2. **価格計算機能**
   - 商品タイプに応じた価格計算
   - 注文明細ごとの小計計算
   - 注文全体の合計金額計算

3. **イベント生成機能**
   - 注文確定イベント（配送部門向け）
   - 請求可能注文イベント（経理部門向け）
   - 確認送信済みイベント（顧客向け）

4. **エラーハンドリング**
   - 検証エラーの適切な処理
   - 価格計算エラーの処理
   - 外部サービスエラーの処理

### システムの特徴

- **ドメイン駆動設計**：ビジネスロジックをドメインモデルに集約
- **関数型プログラミング**：F# による型安全な実装
- **イベント駆動**：各処理結果をイベントとして他システムに通知
- **制約付き型**：ビジネスルールを型システムで表現