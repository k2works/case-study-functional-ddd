---
title: システムユースケース - 注文受付システム
description: 
published: true
date: 2025-09-16
tags: 
editor: markdown
dateCreated: 2025-09-16
---

# システムユースケース - 注文受付システム

## UC001: 🖥️ 注文を受信する 🌊

**使用時のコンテキスト**: 顧客が作成した注文データをシステムが受信し、初期処理を行う

**スコープ**: 注文受付システム

**レベル**: ユーザー目的

**主アクター**: 顧客（システム経由）

**利害関係者と利益**:
- 顧客: 注文が正しく受信されることを期待
- システム管理者: エラーなくデータを受信したい

**事前条件**:
- システムが稼働している
- ネットワーク接続が正常

**最低保証**: 受信ログが記録される

**成功保証時**: 注文データが未検証注文として保存される

**トリガー**: HTTP POST リクエストで注文データが送信される

**主成功シナリオ**:
1. システムがHTTPリクエストを受信する
2. システムがリクエストヘッダーを検証する
3. システムがJSONデータをパースする
4. システムが未検証注文オブジェクトを作成する
5. システムが注文IDを生成する
6. システムが未検証注文を一時保存する
7. システムが受信確認を返す

**拡張**:
- 2a. ヘッダーが不正: 400 Bad Requestを返す
- 3a. JSONパースエラー: 400 Bad Requestを返す
- 6a. 保存エラー: 500 Internal Server Errorを返す

**技術およびデータのバリエーションリスト**:
- 入力形式: JSON、XML（将来対応）
- 通信プロトコル: HTTP/HTTPS
- 文字コード: UTF-8

## UC002: 🖥️ 注文を検証する 🌊

**使用時のコンテキスト**: 受信した注文データの妥当性を検証する

**スコープ**: 注文受付システム

**レベル**: ユーザー目的

**主アクター**: システム（自動処理）

**利害関係者と利益**:
- 営業担当者: 正しい注文のみを処理したい
- 顧客: エラーを早期に知りたい

**事前条件**:
- 未検証注文が存在する
- 検証ルールが定義されている

**最低保証**: 検証結果が記録される

**成功保証時**: 検証済み注文オブジェクトが作成される

**トリガー**: 注文受信完了イベント

**主成功シナリオ**:
1. システムが未検証注文を取得する
2. システムが顧客情報を検証する
   - 名前フィールドの検証（50文字以内、非NULL）
   - メールアドレスの形式検証
3. システムが配送先住所を検証する
   - 住所フィールドの検証
   - 郵便番号の形式検証（5桁数字）
4. システムが請求先住所を検証する
5. システムが各注文明細を検証する
   - 商品コードの存在確認
   - 数量の範囲確認
6. システムが検証済み注文を作成する
7. システムが検証完了イベントを発行する

**拡張**:
- 2a. 顧客情報エラー: ValidationErrorを生成し、処理を中止
- 3a. 住所検証エラー: 外部サービスで住所を確認
- 5a. 商品コード不明: ProductNotFoundエラーを生成
- 5b. 数量範囲外: QuantityOutOfRangeエラーを生成

**技術およびデータのバリエーションリスト**:
- 商品コード形式: Widget（W + 4桁）、Gizmo（G + 3桁）
- 数量範囲: Widget（1-1000）、Gizmo（0.05-100.00）

## UC003: 🖥️ 商品コードを確認する 🐟

**使用時のコンテキスト**: 注文明細の商品コードが有効かを確認する

**スコープ**: 注文受付システム

**レベル**: サブ機能

**主アクター**: 検証サービス

**利害関係者と利益**:
- システム: 有効な商品のみを処理したい

**事前条件**:
- 商品マスタが存在する
- 商品コードが提供されている

**最低保証**: 確認結果が返される

**成功保証時**: 商品コードが有効と確認される

**トリガー**: 注文検証プロセスから呼び出される

**主成功シナリオ**:
1. システムが商品コード文字列を受け取る
2. システムが商品コードの形式を確認する
   - Widget: "W"で始まり4桁の数字
   - Gizmo: "G"で始まり3桁の数字
3. システムが商品マスタを検索する
4. システムが商品の存在を確認する
5. システムが有効フラグを返す

**拡張**:
- 2a. 形式エラー: falseを返す
- 4a. 商品が存在しない: falseを返す

## UC004: 🖥️ 住所を検証する 🐟

**使用時のコンテキスト**: 配送先・請求先住所の妥当性を確認する

**スコープ**: 注文受付システム

**レベル**: サブ機能

**主アクター**: 住所検証サービス

**利害関係者と利益**:
- 配送部門: 正確な住所で配送したい
- 顧客: 確実に商品を受け取りたい

**事前条件**:
- 住所データが提供されている
- 外部住所検証サービスが利用可能

**最低保証**: 検証試行が記録される

**成功保証時**: 住所が有効と確認される

**トリガー**: 注文検証プロセスから呼び出される

**主成功シナリオ**:
1. システムが未検証住所を受け取る
2. システムが必須フィールドを確認する
3. システムが郵便番号形式を検証する（\\d{5}）
4. システムが外部サービスに住所を送信する
5. 外部サービスが住所の存在を確認する
6. システムが検証済み住所オブジェクトを作成する
7. システムが検証済み住所を返す

**拡張**:
- 3a. 郵便番号形式エラー: InvalidFormatエラーを返す
- 5a. 住所が見つからない: AddressNotFoundエラーを返す
- 5b. 外部サービスエラー: RemoteServiceErrorを生成

## UC005: 🖥️ 価格を計算する 🌊

**使用時のコンテキスト**: 検証済み注文の価格を計算する

**スコープ**: 注文受付システム

**レベル**: ユーザー目的

**主アクター**: システム（自動処理）

**利害関係者と利益**:
- 顧客: 正確な価格を知りたい
- 経理部門: 正確な請求額を記録したい

**事前条件**:
- 注文が検証済みである
- 価格表が利用可能である

**最低保証**: 価格計算の試行が記録される

**成功保証時**: 価格付き注文が作成される

**トリガー**: 注文検証完了イベント

**主成功シナリオ**:
1. システムが検証済み注文を取得する
2. システムが各注文明細を処理する
   - 商品コードから単価を取得する
   - 数量タイプを確認する（単位/重量）
   - 小計を計算する（単価 × 数量）
3. システムが明細価格の合計を計算する
4. システムが請求可能金額を確定する
5. システムが価格付き注文を作成する
6. システムが価格計算完了イベントを発行する

**拡張**:
- 2a. 価格が取得できない: PricingErrorを生成
- 3a. 計算オーバーフロー: 計算エラーを記録
- 4a. 請求金額が上限を超える: 警告を生成

**技術およびデータのバリエーションリスト**:
- 価格範囲: 0.00 - 1000.00
- 請求金額上限: 10000.00

## UC006: 🖥️ 注文を確定する 🌊

**使用時のコンテキスト**: 価格計算済みの注文を確定し、関連イベントを生成する

**スコープ**: 注文受付システム

**レベル**: ユーザー目的

**主アクター**: システム（自動処理）

**利害関係者と利益**:
- 全部門: 確定した注文情報を受け取りたい
- 顧客: 注文確定の確認を受けたい

**事前条件**:
- 価格付き注文が存在する
- イベント配信システムが稼働している

**最低保証**: 注文確定の試行が記録される

**成功保証時**: 
- 注文確定イベントが生成される
- 関連部門に通知される
- 顧客に確認が送信される

**トリガー**: 価格計算完了イベント

**主成功シナリオ**:
1. システムが価格付き注文を取得する
2. システムがOrderPlacedイベントを生成する
3. システムが請求金額を確認する
4. 請求金額が0より大きい場合、BillableOrderPlacedイベントを生成する
5. システムが確認メールを作成する
6. システムが確認メールを送信する
7. 送信成功の場合、AcknowledgmentSentイベントを生成する
8. システムが全イベントをイベントストアに保存する
9. システムがイベントを配信キューに登録する

**拡張**:
- 6a. メール送信失敗: エラーをログに記録（処理は継続）
- 8a. イベント保存失敗: リトライ処理を実行
- 9a. キュー登録失敗: デッドレターキューに移動

## UC007: 🖥️ 確認メールを送信する 🐟

**使用時のコンテキスト**: 注文確定後、顧客に確認メールを送信する

**スコープ**: 注文受付システム

**レベル**: サブ機能

**主アクター**: メール送信サービス

**利害関係者と利益**:
- 顧客: 注文内容の確認を受け取りたい
- 営業部門: 顧客への通知を確実に行いたい

**事前条件**:
- 価格付き注文が存在する
- メールサービスが利用可能
- 顧客のメールアドレスが有効

**最低保証**: 送信試行が記録される

**成功保証時**: 確認メールが送信される

**トリガー**: 注文確定プロセスから呼び出される

**主成功シナリオ**:
1. システムが価格付き注文を受け取る
2. システムがメールテンプレートを読み込む
3. システムが注文情報をテンプレートに埋め込む
   - 注文ID
   - 顧客名
   - 注文明細
   - 合計金額
4. システムがHTMLメールを生成する
5. システムがメールアドレスを取得する
6. システムがメールを送信する
7. システムが送信結果を返す

**拡張**:
- 2a. テンプレート読み込みエラー: デフォルトテンプレートを使用
- 6a. 送信エラー: NotSentステータスを返す（エラーはログのみ）

## UC008: 🖥️ イベントを配信する 🐟

**使用時のコンテキスト**: 生成されたイベントを関連システムに配信する

**スコープ**: 注文受付システム

**レベル**: サブ機能

**主アクター**: イベント配信サービス

**利害関係者と利益**:
- 配送部門: OrderPlacedイベントを受信したい
- 経理部門: BillableOrderPlacedイベントを受信したい
- 監査部門: 全イベントの記録を保持したい

**事前条件**:
- イベントが生成されている
- 配信先システムが定義されている

**最低保証**: 配信試行が記録される

**成功保証時**: イベントが各システムに配信される

**トリガー**: イベント生成完了

**主成功シナリオ**:
1. システムがイベントリストを取得する
2. システムが各イベントタイプを識別する
3. システムが配信先を決定する
   - OrderPlaced → 配送システム
   - BillableOrderPlaced → 請求システム
   - AcknowledgmentSent → 監査ログ
4. システムがイベントをシリアライズする
5. システムが配信先にイベントを送信する
6. システムが配信確認を記録する

**拡張**:
- 5a. 配信失敗: リトライキューに登録
- 5b. リトライ上限到達: デッドレターキューに移動