---
title: ユーザーストーリー - 注文受付システム
description: 
published: true
date: 2025-09-16
tags: 
editor: markdown
dateCreated: 2025-09-16
---

# ユーザーストーリー - 注文受付システム

## Epic 1: 注文処理

### Story 1.1: 基本的な注文受付
**As a** 顧客  
**I want to** 商品を選択して注文を送信する  
**So that** 必要な商品を購入できる

**受け入れ基準:**
- [ ] 商品カタログから商品を選択できる
- [ ] Widget商品は1〜1000個の範囲で数量を指定できる
- [ ] Gizmo商品は0.05〜100.00kgの範囲で重量を指定できる
- [ ] 配送先住所を入力できる
- [ ] 請求先住所を入力できる
- [ ] 注文送信後に受信確認を受け取れる

**優先度:** 高  
**見積もり:** 8ポイント  
**依存関係:** なし

### Story 1.2: 注文内容の検証
**As a** 営業担当者  
**I want to** 受信した注文が自動的に検証される  
**So that** 無効な注文を早期に発見し、処理効率を上げられる

**受け入れ基準:**
- [ ] 顧客名が50文字以内で入力されていることを確認する
- [ ] メールアドレスが正しい形式（@を含む）であることを確認する
- [ ] 郵便番号が5桁の数字であることを確認する
- [ ] 商品コードが存在することを確認する
- [ ] 数量が商品タイプごとの有効範囲内であることを確認する
- [ ] 検証エラーは適切なエラーメッセージとして記録される

**優先度:** 高  
**見積もり:** 13ポイント  
**依存関係:** Story 1.1

### Story 1.3: 価格の自動計算
**As a** 営業担当者  
**I want to** 注文の価格が自動的に計算される  
**So that** 手動計算のミスを防ぎ、処理時間を短縮できる

**受け入れ基準:**
- [ ] 各注文明細の小計が正しく計算される（単価 × 数量）
- [ ] 注文全体の合計金額が正しく算出される
- [ ] 請求可能金額が算定される
- [ ] 価格が取得できない商品についてはエラーが記録される
- [ ] 計算結果は価格付き注文として保存される

**優先度:** 高  
**見積もり:** 5ポイント  
**依存関係:** Story 1.2

### Story 1.4: 注文の確定処理
**As a** 営業担当者  
**I want to** 検証・価格計算済みの注文を確定する  
**So that** 配送部門と経理部門に適切な指示を送れる

**受け入れ基準:**
- [ ] 注文確定イベント（OrderPlaced）が生成される
- [ ] 請求金額が0より大きい場合、請求可能注文イベント（BillableOrderPlaced）が生成される
- [ ] 顧客に注文確認メールが送信される
- [ ] メール送信成功時に確認送信済みイベント（AcknowledgmentSent）が生成される
- [ ] 全イベントが適切に記録・配信される

**優先度:** 高  
**見積もり:** 8ポイント  
**依存関係:** Story 1.3

## Epic 2: エラーハンドリング

### Story 2.1: 検証エラーの処理
**As a** 営業担当者  
**I want to** 検証エラーの詳細を確認できる  
**So that** 顧客に適切なフィードバックを提供できる

**受け入れ基準:**
- [ ] フィールドごとの検証エラーメッセージが生成される
- [ ] エラーの種類が分類される（必須項目未入力、形式エラー、範囲外など）
- [ ] エラー情報はログに記録される
- [ ] エラー発生時でも システムは安全に継続動作する

**優先度:** 中  
**見積もり:** 5ポイント  
**依存関係:** Story 1.2

### Story 2.2: 価格計算エラーの処理
**As a** 営業担当者  
**I want to** 価格計算でエラーが発生した場合の対処方法を知る  
**So that** 適切に対応できる

**受け入れ基準:**
- [ ] 価格が取得できない商品についてはエラーが記録される
- [ ] 計算オーバーフローが検出される
- [ ] エラー詳細がログに出力される
- [ ] エラー発生時は処理が中断される

**優先度:** 中  
**見積もり:** 3ポイント  
**依存関係:** Story 1.3

### Story 2.3: 外部サービスエラーの処理
**As a** システム管理者  
**I want to** 外部サービス（住所検証、メール送信）のエラーが適切に処理される  
**So that** システム全体の安定性を保てる

**受け入れ基準:**
- [ ] 住所検証サービスのエラーが検出・記録される
- [ ] メール送信エラーが記録される（ただし処理は継続）
- [ ] 外部サービスの応答時間がタイムアウトに設定されている
- [ ] エラー発生時のリトライロジックが実装されている

**優先度:** 中  
**見積もり:** 8ポイント  
**依存関係:** Story 1.2, Story 1.4

## Epic 3: データ管理

### Story 3.1: 商品コードの管理
**As a** 商品管理者  
**I want to** 商品コードの形式が正しく管理される  
**So that** 注文処理で商品を正確に識別できる

**受け入れ基準:**
- [ ] Widget商品コードは"W"＋4桁数字の形式である
- [ ] Gizmo商品コードは"G"＋3桁数字の形式である
- [ ] 無効な商品コードは受け入れられない
- [ ] 商品コードの存在確認ができる

**優先度:** 高  
**見積もり:** 3ポイント  
**依存関係:** なし

### Story 3.2: 注文データの永続化
**As a** システム管理者  
**I want to** 注文データが段階ごとに適切に保存される  
**So that** データの整合性と追跡可能性を保てる

**受け入れ基準:**
- [ ] 未検証注文が一時保存される
- [ ] 検証済み注文が保存される
- [ ] 価格付き注文が保存される
- [ ] 各段階でのデータ変換が記録される
- [ ] データロスが発生しない

**優先度:** 高  
**見積もり:** 5ポイント  
**依存関係:** Story 1.1, Story 1.2, Story 1.3

### Story 3.3: イベントストアの管理
**As a** システム管理者  
**I want to** 発生したイベントが確実に記録される  
**So that** システム間の連携を保証し、監査要件を満たせる

**受け入れ基準:**
- [ ] 全てのイベントがイベントストアに保存される
- [ ] イベントの順序が保持される
- [ ] イベントの再配信が可能である
- [ ] イベントの配信失敗がトラッキングされる

**優先度:** 中  
**見積もり:** 8ポイント  
**依存関係:** Story 1.4

## Epic 4: ユーザーインターフェース

### Story 4.1: 注文受付API
**As a** フロントエンドシステム  
**I want to** REST APIで注文データを送信する  
**So that** 様々なチャネルから注文を受け付けられる

**受け入れ基準:**
- [ ] POST /api/orders エンドポイントが利用できる
- [ ] JSON形式で注文データを受け取れる
- [ ] 適切なHTTPステータスコードが返される
- [ ] エラー時には詳細なエラー情報が返される
- [ ] API仕様書が提供される

**優先度:** 高  
**見積もり:** 5ポイント  
**依存関係:** Story 1.1

### Story 4.2: 注文ステータス照会API
**As a** 顧客サポート担当者  
**I want to** 注文IDで注文状況を照会できる  
**So that** 顧客からの問い合わせに迅速に対応できる

**受け入れ基準:**
- [ ] GET /api/orders/{orderId} エンドポイントが利用できる
- [ ] 注文の現在ステータスが取得できる
- [ ] 注文が存在しない場合は404が返される
- [ ] アクセス権限がチェックされる

**優先度:** 中  
**見積もり:** 3ポイント  
**依存関係:** Story 3.2

## Epic 5: 通知・連携

### Story 5.1: 顧客への確認メール
**As a** 顧客  
**I want to** 注文確定後に確認メールを受け取る  
**So that** 注文内容と処理状況を確認できる

**受け入れ基準:**
- [ ] HTMLメールで注文内容が送信される
- [ ] 注文ID、顧客名、商品詳細、合計金額が含まれる
- [ ] メールテンプレートが適用される
- [ ] 送信失敗時もエラーとして処理せず、ログのみ記録する

**優先度:** 高  
**見積もり:** 5ポイント  
**依存関係:** Story 1.4

### Story 5.2: 配送部門への通知
**As a** 配送担当者  
**I want to** 新しい注文の配送指示を受け取る  
**So that** 迅速に配送準備を開始できる

**受け入れ基準:**
- [ ] OrderPlacedイベントが配送システムに送信される
- [ ] 顧客情報、配送先住所、商品詳細が含まれる
- [ ] イベント配信の失敗時はリトライされる
- [ ] 配信確認が記録される

**優先度:** 高  
**見積もり:** 5ポイント  
**依存関係:** Story 1.4

### Story 5.3: 経理部門への通知
**As a** 経理担当者  
**I want to** 請求可能な注文情報を受け取る  
**So that** 適切に請求処理を行える

**受け入れ基準:**
- [ ] 請求金額が0より大きい注文についてBillableOrderPlacedイベントが送信される
- [ ] 注文ID、請求先住所、請求金額が含まれる
- [ ] 金額が0の注文では請求イベントが生成されない
- [ ] イベント配信の失敗時はリトライされる

**優先度:** 高  
**見積もり:** 3ポイント  
**依存関係:** Story 1.4

---

## ストーリーマッピング

### リリース 1.0 - 基本機能
**目標**: 最小限の注文処理機能を提供する
- Story 1.1: 基本的な注文受付
- Story 1.2: 注文内容の検証
- Story 1.3: 価格の自動計算
- Story 1.4: 注文の確定処理
- Story 3.1: 商品コードの管理
- Story 4.1: 注文受付API
- Story 5.1: 顧客への確認メール

**見積もり合計**: 47ポイント  
**目標期間**: 6スプリント

### リリース 1.1 - 通知機能強化
**目標**: 部門間連携を強化する
- Story 5.2: 配送部門への通知
- Story 5.3: 経理部門への通知
- Story 3.3: イベントストアの管理

**見積もり合計**: 16ポイント  
**目標期間**: 2スプリント

### リリース 1.2 - エラーハンドリング強化
**目標**: システムの安定性を向上させる
- Story 2.1: 検証エラーの処理
- Story 2.2: 価格計算エラーの処理
- Story 2.3: 外部サービスエラーの処理
- Story 3.2: 注文データの永続化

**見積もり合計**: 21ポイント  
**目標期間**: 3スプリント

### リリース 2.0 - 運用機能
**目標**: 運用性と監視機能を追加する
- Story 4.2: 注文ステータス照会API

**見積もり合計**: 3ポイント  
**目標期間**: 1スプリント

---

## 定義完了(Definition of Done)

各ユーザーストーリーは以下の条件を満たした時に完了とみなす：

### 開発完了基準
- [ ] 受け入れ基準を満たすコードが実装されている
- [ ] 単体テストが作成され、すべてパスしている
- [ ] 統合テストが作成され、すべてパスしている
- [ ] コードレビューが完了している
- [ ] 技術ドキュメントが更新されている

### 品質基準
- [ ] 静的解析ツールで品質基準をクリアしている
- [ ] セキュリティチェックをパスしている
- [ ] パフォーマンステストをパスしている（該当する場合）
- [ ] アクセシビリティ要件を満たしている（UI関連の場合）

### 受け入れ基準
- [ ] プロダクトオーナーによる受け入れテストが完了している
- [ ] ユーザビリティテストが完了している（該当する場合）
- [ ] ステージング環境でのテストが完了している
- [ ] 本番環境でのデプロイ準備が完了している