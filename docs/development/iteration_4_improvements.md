# イテレーション 4 改善アクション

## 概要

イテレーション 3 のレトロスペクティブから抽出された改善アクションをイテレーション 4 に組み込みます。

**作成日**: 2025-11-19
**参照**: [レトロスペクティブ 3](retrospective-3.md)

## 改善アクション一覧

### 優先度: 高 🔴

#### A1: イテレーション進行計画の明確化

**問題**:
- イテレーション 3 で Phase 1-7 が未着手
- セッション開始時に Phase 8 のみを実行する指示があり、全体の進行管理が不足

**改善策**:
- イテレーション開始時に全 Phase の進行計画をレビュー
- 各セッションの作業範囲を事前に合意
- Phase 完了後に次の Phase の準備を確認

**期待効果**:
- イテレーションゴールの達成
- ベロシティの正確な測定
- 計画と実績の乖離解消

**担当**: 開発者
**期限**: イテレーション 4 開始時
**実施タイミング**: イテレーション 4 Day 0（計画セッション）

---

#### A2: テストデータベース自動リセット実装

**問題**:
- `appsettings.Development.json` で固定のデータベースファイル（`orders_dev.db`）を使用
- サーバー再起動後も同じデータが残り続ける
- 同じ order_id で再度登録すると UNIQUE 制約違反が発生

**改善策**:
- テスト実行前にデータベースを自動削除・再作成
- 各テストケースでトランザクションロールバック
- CI/CD パイプラインでの一時データベース利用

**期待効果**:
- テストの独立性確保
- データ汚染の防止
- テストの再現性向上

**担当**: 開発者 A
**期限**: イテレーション 4 Day 1-2
**実施タイミング**: Phase 1（Dapper インフラ基盤構築）と並行

---

### 優先度: 中 🟡

#### A3: カバレッジレポート自動生成

**問題**:
- イテレーション 3 でカバレッジレポートが生成されていない
- 改善アクション A5（カバレッジレポート自動公開）が未実施
- コードカバレッジが不明で、品質基準（80% 以上）の達成確認不可

**改善策**:
- `dotnet test --collect:"XPlat Code Coverage"` の実行
- ReportGenerator によるカバレッジレポート生成
- GitHub Actions での自動公開
- カバレッジバッジの README.md 追加

**期待効果**:
- コードカバレッジの可視化
- 品質基準の定量的な確認
- テストの網羅性向上

**担当**: 開発者 B
**期限**: イテレーション 4 Day 3-4
**実施タイミング**: Phase 2（FluentMigrator セットアップ）完了後

---

#### A4: エラーハンドリング標準化

**問題**:
- エラーレスポンスの形式が統一されていない
- エラーコードの体系化が不十分
- クライアント側でのエラーハンドリングが煩雑

**改善策**:
- すべてのエラータイプで StructuredErrorResponse を使用
- エラーコードの体系化（VALIDATION_ERROR, DATABASE_ERROR 等）
- エラーメッセージのローカライゼーション準備

**期待効果**:
- 一貫性のあるエラーレスポンス
- クライアント側でのエラーハンドリング容易化
- デバッグの効率化

**担当**: 開発者 A
**期限**: イテレーション 4 Week 2
**実施タイミング**: Phase 5（Story 1.2 検証機能実装）と並行

---

### 優先度: 低 🟢

#### A5: Swagger ドキュメントの拡充

**問題**:
- 全 API エンドポイントへの Swagger 設定が不完全
- リクエスト・レスポンス例が網羅されていない

**改善策**:
- 全 API エンドポイントへの Swagger 設定追加
- リクエスト・レスポンス例の網羅
- エラーレスポンスの詳細化（既に Phase 8 で部分実施済み）

**期待効果**:
- API ドキュメントの完全性向上
- 開発者体験（DX）の向上

**担当**: 開発者 B
**期限**: イテレーション 4 終了時
**実施タイミング**: 他のタスクの合間

---

## Keep（継続すること）

イテレーション 3 で効果的だった以下のプラクティスを継続します：

### 1. セマンティックコミットによる変更管理

- `/semantic-commit` コマンドの活用
- Conventional Commits 準拠の徹底
- コミット前の品質チェック自動化

### 2. Swagger による API ドキュメント自動生成

- すべての API エンドポイントに Swagger 設定追加
- レスポンススキーマの網羅的な定義
- エラーハンドリングの標準化

### 3. Pre-commit フックによる品質保証

- すべてのコミットで Fantomas フォーマットチェック → ビルド → テスト実行
- 自動フォーマット修正（Fantomas）
- 警告 0、エラー 0 の維持

---

## イテレーション 4 への統合

### Phase 1: Dapper インフラ基盤構築（8h）
- **並行実施**: A2（テストデータベース自動リセット）

### Phase 2: FluentMigrator セットアップ（6h）
- **完了後**: A3（カバレッジレポート自動生成）開始

### Phase 3: OrderRepository 実装（8h）
- 通常実装

### Phase 4: マイグレーション実装（6h）
- 通常実装

### Phase 5: Story 1.2 検証機能実装（8h）
- **並行実施**: A4（エラーハンドリング標準化）

### Phase 6: Story 1.3 価格計算実装（4h）
- 通常実装

### Phase 7: Story 1.4 永続化実装（6h）
- 通常実装

### バッファ: Phase 8（6h）
- **実施**: A5（Swagger ドキュメントの拡充）

---

## 成功指標

イテレーション 4 終了時に以下が達成されていること：

- ✅ A1: イテレーション進行計画が明確化され、Phase 1-7 すべて完了
- ✅ A2: テストデータベース自動リセットが実装され、テストの独立性が確保
- ✅ A3: カバレッジレポートが自動生成され、80% 以上を達成
- ✅ A4: エラーハンドリングが標準化され、一貫性のあるエラーレスポンスを提供
- ✅ Keep 項目がすべて継続実施されている

---

## 関連ドキュメント

- [イテレーション 3 計画](iteration_plan-3.md)
- [レトロスペクティブ 3](retrospective-3.md)
- [リリース計画](release_plan.md)
